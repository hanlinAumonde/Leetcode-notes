# 题目 - 有效数字

## 题目描述

`有效数字`（按顺序）可以分成以下几个部分：

* 若干空格
* 一个 `小数` 或者 `整数`
* （可选）一个 `'e'` 或 `'E'` ，后面跟着一个 `整数`
* 若干空格

`小数`（按顺序）可以分成以下几个部分：

* （可选）一个符号字符（'+' 或 '-'）
* 下述格式之一：
  * 至少一位数字，后面跟着一个点 `'.'`
  * 至少一位数字，后面跟着一个点 `'.'` ，后面再跟着至少一位数字
  * 一个点 `'.'` ，后面跟着至少一位数字

`整数`（按顺序）可以分成以下几个部分：
  * （可选）一个符号字符（'+' 或 '-'）
  * 至少一位数字

部分有效数字列举如下：`["2", "0089", "-0.1", "+3.14", "4.", "-.9", "2e10", "-90E3", "3e+7", "+6e-1", "53.5e93", "-123.456e789"]`

部分无效数字列举如下：`["abc", "1a", "1e", "e3", "99e2.5", "--6", "-+3", "95a54e53"]`

给你一个字符串 `s` ，如果 `s` 是一个 `有效数字` ，请返回 `true` 。


## 题解

### 思路1

正常的循环遍历所有字符，然后在遇到对应特定字符时通过各种不同的if条件判断格式是否有效。在循环开始前设置`haveNum`,`isDot`,`is_E_or_e`来记录判断的中间状态

```java
class Solution {
    public boolean validNumber(String s) {
        if(s.isEmpty()) return false;
        String str = s.strip();
        boolean hasNum = false, isDot = false, isE_or_e = false;
        for(char c : str.toCharArray()){
            if(c >= '0' && c <= '9'){ 
                //遇到数字时设置hasNum的flag为true，
                //下面判断E或e时会清除一次hasNum记录，这样在E或e之后再次读到数字后就能正确判断E或e之后是否有数字
                hasNum = true;
            }
            else if(c == '.'){
                //遇到小数点时，如果之前已经遇到过小数点，或者已经遇到过E或e（因为E或e后不能接小数），格式错误
                //否则设置isDot的flag为true
                if(isDot || isE_or_e) return false;
                isDot = true; 
            }
            else if(c == 'e' || c == 'E'){
                //遇到E或e时，如果之前没遇到过数字（因为无论整数小数，有效格式都至少需要一位整数）
                //或者已经遇到E或e，则格式错误
                
                //否则设置isE_or_e的flag为true，
                //并hasNum的flag为false（为了只清除E或e之前的num记录，以正确判断E或e之后是否存在整数）
                if(!hasNum || isE_or_e) return false; 
                isE_or_e = true;
                hasNum = false;
            }
            else if(c == '+' || c== '-'){
                //读到正负号，只有在开头（所有flag均为false），以及读到E或e之后没有读到过其他字符
                //格式才正确
                if(!((isE_or_e && !hasNum) || (!hasNum && !isDot && !isE_or_e))) return false;
            }
            else return false;
        }
        return hasNum;
    }
}

```

### 思路2 - 有限状态自动机

本题使用有限状态自动机。根据字符类型和合法数值的特点，先定义状态，再画出状态转移图，最后编写代码即可。

#### 字符类型：

空格 `「 」`、数字`「 0—9 」` 、正负号 `「 +, − 」` 、小数点 `「 . 」` 、幂符号 `「 e, E 」` 。

#### 状态定义：

按照字符串从左到右的顺序，定义以下 9 种状态:
* `0`: 开始的空格
* `1`: 幂符号前的正负号
* `2`: 小数点前的数字
* `3`: 小数点、小数点后的数字
* `4`: 当小数点前为空格时，小数点、小数点后的数字
* `5`: 幂符号
* `6`: 幂符号后的正负号
* `7`: 幂符号后的数字
* `8`: 结尾的空格

![](./图片/有效数字-题解.png)

文字解释：
* `0`状态下：
  * 遇到`空格`状态不变
  * 遇到`正负号`进入状态`1`
  * 遇到`数字`进入状态`2`
  * 遇到`小数点`进入状态`4`
* `1`状态下：
  * 遇到`数字`进入状态`2`
  * 遇到`小数点`进入状态`4`
* `2`状态下：
  * 遇到`数字`状态不变
  * 遇到`小数点`进入状态`3`
  * 遇到`E或e`进入状态`5`
  * 遇到`空格`进入状态`8`
* `3`状态下：
  * 遇到`数字`状态不变
  * 遇到`E或e`进入状态`5`
  * 遇到`空格`进入状态`8`
* `4`状态下：
  * 遇到`数字`进入状态`3`
* `5`状态下：
  * 遇到`数字`进入状态`7`
  * 遇到`正负号`进入状态`6`
* `6`状态下：
  * 遇到`数字`进入状态`7`
* `7`状态下：
  * 遇到`数字`状态不变
  * 遇到`空格`进入状态`8`


#### 结束状态：

合法的结束状态有 `2, 3, 7, 8` 。

```java
import java.util.Map;

class Solution {
    public boolean validNumber(String s) {
        // 有限状态自动机（Finite State Machine, FSM）
        // 每个状态用一个 Map<String, Integer> 表示：
        // key 表示输入类别（如 digit / sign / dot / exp / space）
        // value 表示状态转移到的下一个状态编号
        @SuppressWarnings("unchecked")
        Map<String, Integer>[] states = new Map[] {
                // 状态 0：起始状态（可能遇到空格、符号、小数点或数字）
                Map.ofEntries(
                        Map.entry("space", 0),  // 空格留在状态0
                        Map.entry("sign", 1),   // 正负号 → 状态1
                        Map.entry("digit", 2),  // 数字 → 状态2
                        Map.entry("dot", 4)     // 小数点 → 状态4
                ),
                // 状态 1：符号后（可能接数字或小数点）
                Map.ofEntries(
                        Map.entry("digit", 2),  // 数字 → 状态2
                        Map.entry("dot", 4)     // 小数点 → 状态4
                ),
                // 状态 2：整数部分（数字序列，可接小数点、指数、空格）
                Map.ofEntries(
                        Map.entry("digit", 2),  // 数字 → 状态2
                        Map.entry("dot", 3),    // 小数点 → 状态3
                        Map.entry("exp", 5),    // e/E → 状态5
                        Map.entry("space", 8)   // 结尾空格 → 状态8
                ),
                // 状态 3：小数部分（已出现过小数点，仍可继续数字、指数、空格）
                Map.ofEntries(
                        Map.entry("digit", 3),  // 数字 → 状态3
                        Map.entry("exp", 5),    // e/E → 状态5
                        Map.entry("space", 8)   // 空格 → 状态8
                ),
                // 状态 4：小数点前没有数字（必须接数字）
                Map.ofEntries(
                        Map.entry("digit", 3)   // 数字 → 状态3
                ),
                // 状态 5：指数 e/E 后（必须接符号或数字）
                Map.ofEntries(
                        Map.entry("sign", 6),   // 正负号 → 状态6
                        Map.entry("digit", 7)   // 数字 → 状态7
                ),
                // 状态 6：指数符号后（必须接数字）
                Map.ofEntries(
                        Map.entry("digit", 7)   // 数字 → 状态7
                ),
                // 状态 7：指数部分数字中（可接数字或空格）
                Map.ofEntries(
                        Map.entry("digit", 7),  // 数字 → 状态7
                        Map.entry("space", 8)   // 空格 → 状态8
                ),
                // 状态 8：结尾空格（只可继续空格）
                Map.ofEntries(
                        Map.entry("space", 8)   // 空格 → 状态8
                )
        };

        int p = 0; // 当前状态指针
        String t;  // 当前字符类型（digit/sign/dot/exp/space/other）

        // 遍历输入字符串的每个字符
        for (char c : s.toCharArray()) {
            // 分类当前字符
            if (c >= '0' && c <= '9') {
                t = "digit";
            } else if (c == '+' || c == '-') {
                t = "sign";
            } else if (c == 'e' || c == 'E') {
                t = "exp";
            } else if (c == '.') {
                t = "dot";
            } else if (c == ' ') {
                t = "space";
            } else {
                t = "?"; // 无效字符
            }

            // 检查该输入是否可导致合法状态转移
            if (!states[p].containsKey(t)) {
                return false; // 当前状态无法接受该输入 → 非法
            }
            // 状态转移
            p = states[p].get(t);
        }

        // 判断结束时是否落在“接受状态”
        // 接受状态：2(整数)、3(小数)、7(指数数值)、8(结尾空格)
        return p == 2 || p == 3 || p == 7 || p == 8;
    }
}

```

