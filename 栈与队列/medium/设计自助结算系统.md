# 题目 - 设计自助结算系统

## 题目

请设计一个自助结账系统，该系统需要通过一个队列来模拟顾客通过购物车的结算过程，需要实现的功能有：

* `get_max()`：获取结算商品中的最高价格，如果队列为空，则返回 `-1`
* `add(value)`：将价格为 `value` 的商品加入待结算商品队列的尾部
* `remove()`：移除第一个待结算的商品价格，如果队列为空，则返回 `-1`

注意，为保证该系统运转高效性，以上函数的均摊时间复杂度均为 `O(1)`


### 示例 1：

输入:
* `["Checkout","add","add","get_max","remove","get_max"]`
* `[[],[4],[7],[],[],[]]`

输出: `[null,null,null,7,4,7]`

### 示例 2：

输入:
* `["Checkout","remove","get_max"]`
* `[[],[],[]]`

输出: `[null,-1,-1]`

### 基础代码结构

```java
class Checkout {

    public Checkout() {}
    
    public int get_max() {}
    
    public void add(int value) {}
    
    public int remove() {}
}

/**
 * Your Checkout object will be instantiated and called as such:
 * Checkout obj = new Checkout();
 * int param_1 = obj.get_max();
 * obj.add(value);
 * int param_3 = obj.remove();
 */
```

### 提示：

* 1 <= `get_max`, `add`, `remove` 的总操作数 <= 10000
* 1 <= `value` <= 10^5

## 题解

这是一个标准的使用单调队列的场景：
* 首先构建一个普通队列`items`标识正常商品队列
* 构建一个单调队列`listMono`，用于以`O(1)`的复杂度获取最高价格的商品
* 对于`add`操作，在`items`中添加完成后，遍历`listMomo`，删除所有小于新加入的值`value`的商品，再把`value`加入单调队列尾部（最低处）
* 对于`remove`操作，在`items`中删除后，需要检查当前单调队列`listMono`头部最大值是否是需要删除的这个`value`，如果是则将其在`listMono`中也删除，否则不操作

注意：添加操作均摊复杂度为`O(1)`，因为其需要每次遍历删除已经添加的商品，而已经添加商品总数是确定的`（N）`，所以到最新的操作为止总共的遍历次数也为`N`,只是每次`add`操作的遍历次数不平均，均摊下来每次`add`操作的平均复杂度为商品数除以操作次数，是常数级

```java
class Checkout {

    private Deque<Integer> items;

    private Deque<Integer> listMono;

    public Checkout() {
        items = new LinkedList<>();
        listMono = new LinkedList<>();
    }
    
    public int get_max() {
        //注意检查队列是否为空
        if(items.isEmpty() || listMono.isEmpty()) return -1;
        return listMono.peekFirst();
    }
    
    public void add(int value) {
        items.offer(value);
        while(!listMono.isEmpty() && listMono.peekLast() < value){
            listMono.removeLast();
        }
        listMono.addLast(value);
    }
    
    public int remove() {
        //注意检查队列是否为空
        if(items.isEmpty()) return -1;
        int itemsRemoved = items.poll();
        if(listMono.peekFirst() == itemsRemoved) listMono.removeFirst();
        return itemsRemoved;
    }
}

/**
 * Your Checkout object will be instantiated and called as such:
 * Checkout obj = new Checkout();
 * int param_1 = obj.get_max();
 * obj.add(value);
 * int param_3 = obj.remove();
 */
```